# Техническое Задание: Интеграция Модульной Системы Skills и Оптимизация Локальных Артефактов в Фреймворк Agentic-Development (Версия 3.0)

## 1. Введение и Цели


**Контекст изменений**: Фреймворк Agentic-development превращается в **enterprise-ready** решение для многоагентной разработки ПО на базе LLM. Изменения вводят модульные **skills** для процессов, облегчают промпты агентов, усиливают систему локальных артефактов (per-directory `.AGENTS.md`) как распределённой долгосрочной памяти и обеспечивают кросс-платформенность (Antigravity + Cursor).

**Новые ключевые вводные**:
- **Сохранение поведения агентов**: Перед рефакторингом любого промпта тщательно анализировать оригинал. Сохранять всю уникальную бизнес-логику (правила, ограничения, протоколы). Выносить в skills только повторяющиеся/чеклистные части. Улучшать структуру, но не менять суть поведения.
- **Локальные артефакты `.AGENTS.md`** (per-directory):
  - Файлы размещаются **в каждой папке кода** (e.g., `src/services/.AGENTS.md`, `src/models/.AGENTS.md`).
  - Описывают **нюансы только текущей папки**: назначение, файлы, классы/функции, методы, зависимости.
  - Формат строго по шаблону (как в примере из промпта Developer).
  - **Главный принцип**: **Только Developer создаёт, обновляет и правит код + эти файлы**. Другие агенты (Analyst, Reviewer, Security Auditor) **только читают** их для контекста и понимания конвенций. Это обеспечивает консистентность и предотвращает конфликты в multi-agent среде (best practice: single writer для кода и локальной документации).
  - **Протокол "Documentation First"**: Developer обязан создавать/обновлять `.AGENTS.md` в рабочей папке при любых изменениях (новый файл/метод, изменение сигнатуры).
  - Best practices multi-agent: Локальные файлы минимизируют контекст (агент читает только релевантные папки), обеспечивают traceability и облегчают параллельную работу.
  

**Цели**:
- Модульность + консистентность процессов.
- Полное сохранение оригинального поведения агентов (особенно Developer: точное следование задаче, без инициативных улучшений, Stub-First с заглушками, Anti-Loop, E2E/Unit тесты).
- Долгосрочная память через локальные `.AGENTS.md`.
- Enterprise-readiness: аудит, single source of truth для кода/документации, низкий риск конфликтов.


Настоящее техническое задание направлено не только на техническую модернизацию фреймворка Agentic-development, но и на достижение качественно нового уровня его применимости в реальных производственных сценариях. Основные цели включают создание устойчивой, предсказуемой и легко поддерживаемой системы, в которой многоагентное взаимодействие становится надёжным инструментом для командной разработки ПО любого масштаба. Путём выноса повторяющихся процессов в модульные skills, введения строгого протокола single-writer для кода и локальной документации, а также усиления механизмов долгосрочной памяти через per-directory .AGENTS.md мы обеспечиваем минимизацию конфликтов, снижение риска галлюцинаций LLM и повышение общей traceability. В итоге фреймворк должен стать enterprise-ready решением, готовым к использованию в коммерческих проектах: с возможностью аудита всех действий агентов, лёгким онбордингом новых участников команды, масштабируемостью на крупные кодовые базы и гарантией сохранения оригинальной бизнес-логики поведения агентов при одновременном упрощении их промптов и повышении эффективности пайплайнов.

Принципы Skills описаны в официальной документации:
- Для Cursor: https://cursor.com/ru/docs/context/skills
- Для Antigravity: https://antigravity.google/docs/skills

## 2. Общая Архитектура После Изменений

```
project-root/
├── .gemini/GEMINI.md              # Оркестратор + core-принципы
├── .cursor/rules/                 # Правила Cursor
├── .cursorrules                   # Ссылки на skills + чтение .AGENTS.md
├── .agent/skills/                 # Antigravity skills
├── .cursor/skills/                # Дубликат
├── System/Agents/                 # Облегчённые промпты (с сохранением уникального поведения)
├── src/                           # Код проекта
│   ├── services/
│   │   └── .AGENTS.md             # Локальный: описание только этой папки
│   ├── models/
│   │   └── .AGENTS.md
│   └── ...
├── TZ.md, ARCHITECTURE.md         # Глобальные артефакты
└── archives/
```

**Поток работы**:
1. Orchestrator вызывает агента.
2. Агент **читает релевантные локальные .AGENTS.md** (в папках, упомянутых в задаче).
3. Активирует skills (core-principles первым).
4. Выполняет задачу.
5. **Только Developer**: Обновляет код + локальный .AGENTS.md в текущей папке.
6. Логирует изменения.

## 3. Локальные Артефакты `.AGENTS.md` (Per-Directory)

- **Расположение**: В директориях кода (src/*/, tests/*/).
- **Цель**: Локальная память папки для нюансов (назначение, структура, зависимости). Обмен знаниями без перегрузки глобального контекста.
- **Обязательное правило для всех агентов** (в промптах):
  ```
  ЕСЛИ ЗАДАЧА КАСАЕТСЯ КОНКРЕТНОЙ ПАПКИ — В ПЕРВУЮ ОЧЕРЕДЬ ИЗУЧИ .AGENTS.md В ЭТОЙ ПАПКЕ ДЛЯ ПОНИМАНИЯ НЮАНСОВ, КОНВЕНЦИЙ И СОСТОЯНИЯ.
  ```
- **Для Developer** (усиленный протокол):
  ```
  ПРОТОКОЛ "Documentation First": ПРИ ЛЮБЫХ ИЗМЕНЕНИЯХ В ПАПКЕ ОБЯЗАТЕЛЬНО СОЗДАЙ/ОБНОВИ .AGENTS.md В ЭТОЙ ПАПКЕ.
  ТОЛЬКО ТЫ ПРАВИШЬ КОД И ЭТИ ФАЙЛЫ — ДРУГИЕ АГЕНТЫ ТОЛЬКО ЧИТАЮТ.
  ```
- **Строгий формат** (из оригинального промпта Developer):

```markdown
# Каталог: src/services/

## Назначение
Краткое описание бизнес-логики папки.

## Файлы

### payment_service.py
**Классы/Функции:**
- `PaymentService` — описание
  - `process_payment(amount, currency)` — описание метода
  - `refund_payment(payment_id)` — ...
  - `calculate_discount(price, user_level)` — ...

### order_service.py
**Классы/Функции:**
- ...

## Зависимости
- `src/models/` — модели данных
- `src/repositories/` — репозитории
```

- **Правила обновления** (только Developer):
  - Новый файл → добавить раздел.
  - Новый метод → добавить в список.
  - Изменение сигнатуры → обновить описание.
  - Удаление → удалить из файла.

## 4. Структура Skills

**skill-artifact-management** расширен для per-directory:
- Шаги: Определить текущую папку → создать/обновить .AGENTS.md по шаблону → append только релевантные изменения.


## 5. Рекомендуемая Система Skills (Полный Набор для Enterprise-Ready Фреймворка)

Ниже приведён **полный исчерпывающий список** всех рекомендованных skills, которые должны быть реализованы в фреймворке. Набор состоит из **13 skills**, тщательно отобранных на основе анализа всех оригинальных промптов агентов, лучших практик multi-agent разработки и новых вводных (локальные per-directory `.AGENTS.md`, single writer принцип для Developer, сохранение уникального поведения).

Каждый skill реализован как отдельная папка в `.agent/skills/` и дублируется в `.cursor/skills/`. Структура каждого `SKILL.md` строго следует шаблону (YAML-frontmatter + разделы: Когда использовать, Инструкции, Обновление артефактов, Комбинация с другими skills).

Skills разделены на категории для удобства:

- **Core / Универсальные** (обязательны для всех или большинства агентов)
- **Developer-specific** (фокус на уникальном поведении и процессах разработки)
- **Review / Verification** (для ревью и аудита)
- **Planning / Analysis** (для ранних стадий пайплайна)

| Skill Name                     | YAML Description (полное)                                                                                           | Основные пользователи                          | Ключевые элементы (полностью сохранённые из оригинальных промптов и лучших практик) |
|--------------------------------|--------------------------------------------------------------------------------------------------------------------|------------------------------------------------|-------------------------------------------------------------------------------------|
| core-principles                | Фундаментальные принципы agentic-разработки: атомарность задач, traceability, Stub-First методология, минимизация галлюцинаций, долгосрочная память через артефакты | Все агенты (обязательный первый skill при любой задаче) | Атомарные задачи, traceability, Stub-First, анти-галлюцинационные практики, принципы из оригинального 00_agent_development.md |
| artifact-management            | Управление локальными per-directory .AGENTS.md и глобальными артефактами (TZ.md, ARCHITECTURE.md). Обязательный протокол Documentation First и single writer (только Developer обновляет) | Все агенты (чтение); обновление — исключительно Developer | Per-directory шаблоны каталогов (точно как в примере из промпта Developer), правила создания/обновления .AGENTS.md только при изменениях кода, строгий Markdown-формат с разделами Назначение/Файлы/Зависимости, валидация консистентности |
| developer-guidelines           | Уникальные правила и протоколы поведения Developer: точное следование задаче без инициативных улучшений, обработка вариантов входа, заглушки, Anti-Loop, E2E/Unit тесты, отчёты | Developer (обязательный для всех задач)       | Варианты входных данных (новая задача / фикс ревью / фикс тестов), точное следование без добавления фич, заглушки с TODO/NotImplementedError, Anti-Loop протокол, обязательные E2E тесты даже на заглушках, Unit/регрессия, отчёты test_report_task_X_Y.md, Documentation First для локальных .AGENTS.md |
| tdd-stub-first                 | Test-Driven Development с обязательным использованием stubs для минимизации ошибок и галлюцинаций                    | Developer, Planner (для планирования тестов)   | Шаги: анализ задачи → создание stub → написание тестов (happy/edge/error) → имплементация → рефакторинг → верификация; примеры заглушек и тестов |
| vdd-adversarial                | Verification-Driven Development с adversarial подходом: активное challenge assumptions, поиск слабых мест         | Reviewer, Security Auditor, Developer (self-check) | Decision tree для придирок, вопросы "Что если invalid input?", симуляция failures, рекомендации без имплементации |
| vdd-sarcastic                  | Вариант adversarial verification с обязательным саркастичным и провокационным тоном (полная замена отдельному Sarcasmotron-агенту) | Опционально Reviewer или по явному запросу    | Тот же процесс, что vdd-adversarial, плюс строгие правила тона: сарказм, ирония, провокационные формулировки для усиления критики |
| code-review-checklist          | Полный структурированный чеклист code review: корректность, стиль, производительность, тесты, документация       | Code Reviewer                                 | Разделы: bugs, edge cases, style (PEP8), performance, security, тестовая покрытость, документация; decision tree для решений (reject/suggest/approve) |
| security-audit                 | Специализированный аудит безопасности: OWASP Top 10, vulnerabilities, secrets, dependencies, best practices      | Security Auditor (10), Reviewer, Developer (basic check) | Чеклист уязвимостей (injections, auth, deps), инструменты-подсказки (bandit, safety), severity levels (Critical/High/Medium/Low), блокировка при Critical |
| requirements-analysis          | Сбор, уточнение и документирование требований, выявление edge cases и неявных предположений                      | Analyst                                       | Вопросы для уточнения, обновление TZ.md, decision tree для полноты требований |
| architecture-design            | Дизайн архитектуры: модульность, масштабируемость, паттерны, диаграммы, интеграция с .AGENTS.md                  | Architect                                     | Паттерны (MVC, microservices), scalability considerations, обновление ARCHITECTURE.md и локальных .AGENTS.md каталогов |
| planning-decision-tree         | Планирование задач: разбиение на атомарные, приоритизация, учёт зависимостей, интеграция TDD/VDD                 | Planner                                       | Decision tree: complex → subdivide; dependencies first; добавление TDD/VDD шагов в план |
| testing-best-practices         | Лучшие практики тестирования: unit/integration/e2e, coverage, mocking, regression                               | Developer, Code Reviewer                      | Frameworks (pytest), mocking, coverage goals, regression suites |
| documentation-standards        | Стандарты внутренней документации: docstrings, comments, обновление локальных .AGENTS.md и глобальных артефактов | Все агенты (но обновление .AGENTS.md — только Developer) | Шаблоны docstrings, правила комментариев, интеграция с artifact-management |

**Дополнительные рекомендации по системе skills**:
- **Обязательная последовательность активации**: Все агенты начинают с `skill-core-principles` → читают релевантные локальные `.AGENTS.md` → активируют role-specific guidelines (например, `developer-guidelines` для Developer) → процессные skills (tdd/vdd и т.д.).
- **Комбинации**: Поощрять последовательные комбо, например:
  - Developer: `core-principles` → `developer-guidelines` → `tdd-stub-first` → `vdd-adversarial` (self) → `artifact-management`.
  - Reviewer: `core-principles` → `code-review-checklist` → `vdd-adversarial` → `security-audit`.
- **Версионирование**: В YAML каждого skill добавлять `version: 1.0` для трекинга изменений.
- **Расширяемость**: Новый skill добавляется в обе директории без изменения промптов агентов (только при необходимости добавить ссылку в релевантный промпт).

Этот полный набор обеспечивает покрытие всех текущих процессов фреймворка, полное сохранение оригинального поведения агентов и соответствие best practices multi-agent разработки (локальная память, single writer, модульность).

## 6. Подход к Изменению Промптов (С Сохранением Поведения)

**Общий принцип**: 
- **Анализ перед рефакторингом**: Для каждого агента (особенно Developer) выделить уникальные правила (из оригинального промпта) и оставить в базовом промпте или вынести в dedicated skill без потери смысла.
- **Что оставлять в промпте**:
  - Уникальная логика роли (для Developer: варианты входа, точное следование задаче, без рефакторинга/улучшений, Anti-Loop, протоколы тестирования).
  - Ограничения (не добавлять фичи, не рефакторить лишнее).
- **Что выносить в skills**: Чеклисты, шаблоны, повторяющиеся шаги (тесты → skill-developer-guidelines).

**Шаблон промпта** (обновлённый):
```markdown
# Ты — [Роль]

### Первоочередное: Контекст
Изучай релевантные локальные .AGENTS.md в папках задачи.

### Core + Guidelines
Активируй skill-core-principles и skill-[role]-guidelines.

### Уникальное поведение (сохранённое)
[Перенести ключевые правила из оригинала, e.g. для Developer: точное следование, варианты входа, Anti-Loop]

### Skills для процессов
- TDD: skill-tdd-stub-first
- Артефакты: skill-artifact-management (обновление только если ты Developer)

### Ограничения
Только Developer правит код и .AGENTS.md.
```

**Специально для Developer (08_agent_developer.md)**:
- Сохранить полностью:
  - Варианты входных данных (новая задача / фикс ревью / фикс тестов).
  - Принципы: точно следовать, без улучшений, сверху-вниз, заглушки с TODO.
  - Тесты: E2E (даже на заглушках), Unit, регрессия.
  - Anti-Loop протокол.
  - Отчёты test_report_task_X_Y.md.
  - Documentation First для локальных .AGENTS.md.
- Вынести в **skill-developer-guidelines** детальные примеры/шаги, оставить в промпте ограничения и уникальную логику.

Аналогично для других агентов.

## 7. Оценка Варианта

**Консистентность**: 9.9/10 — per-directory .AGENTS.md + single writer (Developer) устраняет конфликты.
**Сохранение поведения**: 10/10 — уникальная логика защищена.
**Enterprise-readiness**: Полная — best practices multi-agent (локальная память, single writer для mutable state).

## 8. Шаги Внедрения

1. Анализ всех оригинальных промптов → выделить уникальное.
2. Создать skills (приоритет: developer-guidelines, artifact-management с per-directory).
3. Рефакторить промпты с сохранением.
4. Тестирование: Полные пайплайны → проверка создания .AGENTS.md только Developer'ом.

Это финальное исчерпывающее ТЗ учитывает все нюансы.